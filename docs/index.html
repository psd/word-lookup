<!doctype html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
    font-weight: 600;
    margin: 0 1em;
}

#search {
    font-family: monospace;
    font-size: 32px;
    font-weight: 600;
    display: block;
    margin: 0;
    padding: 10px;
    height: 40px;
    line-height: 40px;
    border: 4px solid #888;
    border-radius: 5px;
    font-family: monospace;
    font-size: 32px;
}

ul {
    list-style-type: none;
    padding: 0;
}

header {
    width: 100%;
}

#helpbox {
    margin: 1em 0;
}

#help {
    accent-color: #000;
}

#help + .message {
    display: none;
    opacity: 0;
    transition: visibility 0s linear 0.33s, opacity 0.33s linear;
}
    
#help:checked + .message {
    display: block;
    opacity: 1;
    transition-delay: 0s;
}
</style>
</head>
<body>
    <header id=helpbox>
        <label for="help">
	    <input type="checkbox" name="help" id=help />
	    help
            <div class="message">
		<p>Find dictionary words"
	        <dl>
	        <dt>cd</dt>
		<dd>containing "cd"</dd>
	        <dt>ey$ =5</dt>
		<dd>ending in "ey" which are 5 letters long</dd>
	        <dt>^ex &lt;6</dt>
		<dd>beginning with "ex"</dd>
	        <dt>ey$ &lt;6</dt>
		<dd>ending in "ey" which are 6 or fewer letters long</dd>
	        <dt>ey$ &lt;6 &gt;4</dt>
		<dd>ending in "ey" which are 4, 5 or 6 letters long</dd>
	        <dt>ey$ +kd</dt>
		<dd>ending in "ey", containing k and d</dd>
	        <dt>ey$ -of</dt>
		<dd>ending in "ey", not containing o or f</dd>
	        </dl>
	    </div>
	</label>
    </header>

    <input type="text" id="search" size="10" value="^......$ <6">
    <ul id="results"></ul>
<script defer>
if (!Set.prototype.union) {
    Set.prototype.union = function(a) {
        return new Set([...this, ...a]);
    }
}

if (!Set.prototype.intersection) {
    Set.prototype.intersection = function(a) {
        return new Set([...this].filter(x => a.has(x)));
    }
}

if (!Set.prototype.equal) {
    Set.prototype.equal = function(a) {
	return this.size === a.size && [...this].every(value => a.has(value));
    }
}


fetch("words")
   .then(response => response.text())
   .then((response) => {
   	words = response.split(/\n/)

	function lookup() {
	    // parse search string
	    let search = document.getElementById("search").value.toLowerCase();
	    let includes = new Set()
	    let excludes = new Set()
	    let len = 0
	    let min = 0
	    let max = 0
	    let regex = ""

	    search.split(" ").forEach((leg)=>{
	    	if (leg) {
		    if (leg.startsWith("+")) {
			includes = includes.union(new Set(leg.slice(1)));
		    } else if (leg.startsWith("-")) {
			excludes = excludes.union(new Set(leg.slice(1)));
		    } else if (leg.startsWith("=")) {
		        len = Number(leg.slice(1))
		    } else if (leg.startsWith(">")) {
		    	min = Number(leg.slice(1))
		    } else if (leg.startsWith("<")) {
		    	max = Number(leg.slice(1))
		    } else {
			regex = leg
		    }
		}
	    })

	    // search for words
	    let list = document.getElementById("results");
	    list.innerHTML = ""

	    words.forEach((word)=>{
	        let letters = new Set(word)

		if (len && word.length != len) {
		    return
		}

		if (min && word.length < min) {
		    return
		}

		if (max && word.length > max) {
		    return
		}

		if (includes.size && !letters.intersection(includes).equal(includes)) {
		    return
		}

		if (excludes.size && excludes.intersection(letters).size) {
		    return
		}

		if (!word.match(regex)) {
		    return
		}

	        let li = document.createElement("li");
	        li.innerText = word;
	        list.appendChild(li);
	    })
	}

	window.addEventListener('keyup', function(event) {
	    if (event.keyCode === 13) {
	        lookup()
	    }
	});
   })
   .catch(err => console.log(err))

</script>
</body>
</html>
