<!doctype html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
    font-family: monospace;
    font-size: 32px;
    font-weight: 600;
}
body {
    margin: 1em;
}
input {
    -webkit-appearance: none;
    -moz-appearance: none;
    font-size: 32px;
    font-weight: 600;
    display: block;
    margin: 0;
    padding: 10px;
    height: 40px;
    line-height: 40px;
    border: 2px solid #bbb;
}
ul {
    list-style-type: none;
    padding: 0;
}
</style>
</head>
<body>
    <input type=text id=search size=10 value="^......$">
    <ul id="results"></ul>
<script defer>
if (!Set.prototype.union) {
    Set.prototype.union = function(a) {
        return new Set([...this, ...a]);
    }
}

if (!Set.prototype.intersection) {
    Set.prototype.intersection = function(a) {
        return new Set([...this].filter(x => a.has(x)));
    }
}

if (!Set.prototype.equal) {
    Set.prototype.equal = function(a) {
	return this.size === a.size && [...this].every(value => a.has(value));
    }
}


fetch("words")
   .then(response => response.text())
   .then((response) => {
   	words = response.split(/\n/)

	function lookup() {
	    // parse search string
	    let search = document.getElementById("search").value.toLowerCase();
	    let includes = new Set()
	    let excludes = new Set()
	    let min = 0
	    let max = 0
	    let regex = ""

	    search.split(" ").forEach((leg)=>{
	    	if (leg) {
		    if (leg.startsWith("+")) {
			includes = includes.union(new Set(leg.slice(1)));
		    } else if (leg.startsWith("-")) {
			excludes = excludes.union(new Set(leg.slice(1)));
		    } else if (leg.startsWith(">")) {
		    	min = Number(leg.slice(1))
		    } else if (leg.startsWith("<")) {
		    	max = Number(leg.slice(1))
		    } else {
			regex = leg
		    }
		}
	    })

	    // search for words
	    let list = document.getElementById("results");
	    list.innerHTML = ""

	    words.forEach((word)=>{
	        let letters = new Set(word)

		if (min && word.length < min) {
		    return
		}

		if (max && word.length > max) {
		    return
		}

		if (includes.size && !letters.intersection(includes).equal(includes)) {
		    return
		}

		if (excludes.size && excludes.intersection(letters).size) {
		    return
		}

		if (!word.match(regex)) {
		    return
		}

	        let li = document.createElement("li");
	        li.innerText = word;
	        list.appendChild(li);
	    })
	}

	window.addEventListener('keyup', function(event) {
	    if (event.keyCode === 13) {
	        lookup()
	    }
	});
   })
   .catch(err => console.log(err))

</script>
</body>
</html>
